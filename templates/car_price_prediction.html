<!doctype html>
<html>

<!--This is the header of the html script-->
<head>

<!--Add a title to this html script-->
<title>Car Price Prediction</title>

<!--Add a description to this html script-->
<meta name="description", content="Car Price Prediction">

</head>

<!--This is the body of the html script-->
<body class="bg-dark">
<style>
    h1 {text-align: center;
        /*font-style: oblique;*/
        font-family: 'Times New Roman';
        margin-left: 30px;
        margin-right: 30px;
    }
    form {
        text-align: center;
        background-color: aquamarine;
        margin-left: 30px;
        margin-right: 30px;
    }
    select {
    width: 35%;
    padding:10px;
    border-radius:40px;}

    input {

  /* remove default behavior */
  appearance:none;
  -webkit-appearance:none;

  /* usual styles */
  padding:10px;
  border:none;
  background-color:#3F51B5;
  color:#fff;
  font-weight:600;
  border-radius:5px;
  width:35%;
    }

</style>

<h1 style="background-color:lightskyblue;font-size:60px;">Car Price Predictor</h1>

<!--Make a form with car action and get method-->
<form method="post">
    <!--Make a select feature to choose the company-->
    <br><br>
    <label for="companies"
           style="font-size:30px;">Choose the
        company:</label>
        <select name = "company" id="companies" style="font-size:30px;"
                onchange="get_car_models(this.id, 'models')">
            {% for company in companies %}
                <option value="{{company}}">{{company}}</option>
            {% endfor %}
            {% if company == 'default' %}
                <option value="default" selected disabled>None
                    selected</option>
            {% else %}
                <option value="{{company}}" selected>{{company}}</option>
            {% endif %}
        </select> <br><br><br><br>

    <!--Make a select feature to choose the company-->
    <label for="models"
           style="font-size:30px;">Choose the
        model:</label>
        <select name = "model" id="models" style="font-size:30px;">
            {% for car_model in car_models %}
                <option value="{{car_model}}">{{car_model}}</option>
            {% endfor %}
            {% if car_model == 'default' %}
                <option value="default" selected disabled>None
                    selected</option>
            {% else %}
                <option value="{{car_model}}" selected>{{car_model}}</option>
            {% endif %}
        </select><br><br><br><br>

    <!--Make a select feature to choose the year of purchase-->
    <label for="years"
           style="font-size:30px;">Choose the
        year of purchase:</label>
        <select name = "year" id="years" style="font-size:30px;">
            {% for year in years %}
                <option value="{{year}}">{{year}}</option>
            {% endfor %}
            {% if year == 'default' %}
                <option value="default" selected disabled>None
                    selected</option>
            {% else %}
                <option value="{{year}}" selected>{{year}}</option>
            {% endif %}
        </select> <br><br><br><br>

    <!--Make a select feature to choose the year of purchase-->
    <label for="fuels"
           style="font-size:30px;">Choose the
        fuel type:</label>
        <select name = "fuel" id="fuels" style="font-size:30px;">
            {% for fuel_type in fuel_types %}
                <option value="{{fuel_type}}">{{fuel_type}}</option>
            {% endfor %}
            {% if fuel_type == 'default' %}
                <option value="default" selected disabled>None
                    selected</option>
            {% else %}
                <option value="{{fuel_type}}" selected>{{fuel_type}}</option>
            {% endif %}
        </select><br><br><br><br>

    <!--Make an input feature to enter mileage-->
    <label for = "mileage" style="font-size:30px;">Please enter
        the mileage: </label><br><br>
    <input type="text" id="mileage" name="mileage" value="{{mileage}}"
           style="font-size:20px; width: 20%" >
    <br><br><br><br>

     <input type="submit" value="Predict Price" style="font-size:30px;"
            onclick="send_data()">
    <br><br><br><br>
</form>
<div class="row">
    <div class="col-12" style="text-align: center">
        <h3><span id="prediction"></span> </h3>
    </div>
</div>

<script>
    function get_car_models(company_id, car_model_id)
    {
        var company = document.getElementById(company_id);
        var car_model = document.getElementById(car_model_id);
        car_model.value = ''
        car_model.innerHTML = ''
        {% for company in companies %}
            if (company.value == "{{company}}")
            {
                {% for model in car_models %}
                    {% if company in model %}
                        var newOption = document.createElement("option");
                        newOption.value="{{model}}";
                        newOption.innerHTML="{{model}}";
                        car_model.options.add(newOption);
                    {% endif %}
                {% endfor %}
            }
        {% endfor %}
    }

    function form_handler()
    {
        event.preventDefault()
    }

    // causes some issues right now
    function send_data()
    {
        document.querySelector('form').addEventListener("submit", form_handler);
        var fd=new FormData(document.querySelector('form'));
        var xhr= new XMLHttpRequest({mozSystem: true});

        xhr.open('POST','/predict',true);
        document.getElementById("prediction").innerHTML="Wait! Predicting Price.....";
        xhr.onreadystatechange = function(){
            if(xhr.readyState == XMLHttpRequest.DONE){
                document.getElementById('prediction').innerHTML="Prediction: $"+xhr.responseText;
            }
        };

        xhr.onload= function(){};
        xhr.send(fd);
}


</script>

</body>

</html>


